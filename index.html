<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MARSHALL06178 | Scramjet Portal</title>
  <style>
    :root {
      --bg: radial-gradient(circle at 20% 20%, rgba(103, 237, 198, 0.08), transparent 36%),
        radial-gradient(circle at 82% 14%, rgba(129, 172, 255, 0.12), transparent 42%),
        radial-gradient(circle at 48% 82%, rgba(129, 211, 255, 0.08), transparent 48%),
        #050814;
      --panel: rgba(255, 255, 255, 0.05);
      --panel-strong: rgba(255, 255, 255, 0.08);
      --border: rgba(255, 255, 255, 0.08);
      --text: #f6f8ff;
      --muted: #9fb1d3;
      --accent: #7ee7c6;
      --accent-2: #7fb3ff;
      --accent-3: #ffda7f;
      --danger: #ff7b7b;
      --radius: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px 14px 40px;
    }

    .shell {
      width: min(1100px, 100%);
      background: linear-gradient(150deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 26px;
      box-shadow: 0 20px 90px rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(12px);
      transform: translateY(12px);
      opacity: 0;
      animation: floatIn 700ms ease forwards;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .brand {
      font-size: 30px;
      letter-spacing: 0.6px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 800;
    }

    .badge {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(124, 231, 200, 0.14);
      color: var(--accent);
      font-size: 12px;
      border: 1px solid rgba(124, 231, 200, 0.3);
    }

    .hint { color: var(--muted); margin: 0; }

    .grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 14px;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .card h2 { margin: 0 0 8px; }
    .card p { margin: 0 0 12px; color: var(--muted); }

    .search-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }

    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 15px;
      outline: none;
      transition: border-color 160ms ease, transform 160ms ease, box-shadow 180ms ease;
    }

    input:focus {
      border-color: var(--accent);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(124, 231, 200, 0.16);
    }

    button {
      padding: 13px 18px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #041220;
      font-weight: 700;
      letter-spacing: 0.3px;
      box-shadow: 0 14px 35px rgba(122, 179, 255, 0.28);
      transition: transform 150ms ease, box-shadow 180ms ease, filter 150ms ease;
    }

    button:hover { transform: translateY(-1px); box-shadow: 0 16px 40px rgba(124, 231, 200, 0.28); }
    button:active { transform: translateY(0); }

    .button-ghost {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      box-shadow: none;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }

    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.03);
      color: var(--text);
      font-size: 13px;
      cursor: pointer;
      transition: transform 140ms ease, border-color 160ms ease;
    }

    .chip:hover { transform: translateY(-1px); border-color: rgba(124, 231, 200, 0.4); }

    .links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .link-card {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 12px 14px;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text);
      text-decoration: none;
      transition: transform 140ms ease, border-color 160ms ease;
      display: block;
      cursor: pointer;
      text-align: left;
    }

    .link-card:hover { transform: translateY(-1px); border-color: rgba(124, 231, 200, 0.5); }

    .status {
      margin-top: 10px;
      color: var(--muted);
      font-size: 14px;
      min-height: 20px;
    }

    .status.error { color: var(--danger); }
    .status.success { color: var(--accent); }

    .viewer-card { margin-top: 16px; }

    .viewer {
      margin-top: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow: hidden;
      background: rgba(255, 255, 255, 0.04);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
      transition: max-height 240ms ease, opacity 240ms ease, transform 180ms ease;
      max-height: 0;
      opacity: 0;
    }

    .viewer.active { max-height: 820px; opacity: 1; }

    .viewer iframe {
      display: block;
      width: 100%;
      height: 760px;
      border: none;
      background: #050a16;
    }

    .viewer.fullscreen {
      position: fixed;
      inset: 16px;
      max-height: none;
      z-index: 9;
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.55);
      opacity: 1;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .pill { padding: 8px 12px; border-radius: 10px; background: rgba(255, 255, 255, 0.05); color: var(--muted); font-size: 13px; }
    .pill strong { color: var(--text); }
    .pill.good { color: var(--accent); }

    .stack { display: flex; gap: 10px; flex-wrap: wrap; }

    .recent { margin-top: 14px; display: flex; flex-direction: column; gap: 8px; }
    .recent-item { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.03); }
    .recent-item span { color: var(--muted); word-break: break-all; }

    .caps { font-size: 12px; color: var(--danger); min-height: 16px; }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(5, 7, 17, 0.88);
      backdrop-filter: blur(12px);
      display: grid;
      place-items: center;
      z-index: 10;
      transition: opacity 240ms ease;
    }

    .overlay.hide { opacity: 0; pointer-events: none; }

    .lock-card {
      width: min(420px, 92vw);
      padding: 22px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 14px 50px rgba(0, 0, 0, 0.35);
      animation: floatIn 420ms ease;
    }

    .lock-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 8px; }
    .lock-card h2 { margin: 0; }
    .lock-card p { margin: 0 0 12px; color: var(--muted); }

    .pass-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
    .toggle-pass { padding: 12px 14px; }

    @keyframes floatIn {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand">MARSHALL06178 <span class="badge">Scramjet embedded</span></div>
      <p class="hint">Search, launch, and stay inside the MARSHALL06178 portal while Scramjet does the heavy lifting.</p>
    </header>

    <div class="grid">
      <section class="card">
        <h2>Launch center</h2>
        <p>Type a query or paste a URL. Everything stays inside this page with Scramjet.</p>
        <form class="search" autocomplete="off">
          <div class="search-row">
            <input id="query" type="text" placeholder="Search the web or enter a link" />
            <button type="submit">Open in Scramjet</button>
          </div>
        </form>
        <div class="chips" id="chips"></div>
        <div class="status" id="status"></div>
        <div class="caps" id="caps-warning"></div>
      </section>

      <section class="card">
        <h2>Quick deck</h2>
        <p>Jump to popular destinations instantly.</p>
        <div class="links" id="links"></div>
        <div class="status" id="fallback"></div>
      </section>
    </div>

    <section class="card viewer-card">
      <div class="toolbar">
        <div class="pill"><strong>Scramjet</strong> stays on this page</div>
        <div class="pill good" id="toolbar-status">Idle</div>
        <div class="stack">
          <button type="button" class="button-ghost" id="reload">Reload</button>
          <button type="button" class="button-ghost" id="open-direct">Open directly (embedded)</button>
          <button type="button" class="button-ghost" id="fullscreen">Fullscreen</button>
          <button type="button" class="button-ghost" id="clear">Clear frame</button>
        </div>
      </div>
      <div class="viewer" id="viewer">
        <iframe id="scramjet-frame" title="Scramjet" loading="lazy" sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-downloads"></iframe>
      </div>
      <div class="recent" id="recent"></div>
    </section>
  </div>

  <div class="overlay" id="lock">
    <div class="lock-card">
      <div class="lock-header">
        <h2>Access MARSHALL06178</h2>
        <span class="badge">Secure gate</span>
      </div>
      <p>Enter the access password to continue. Attempts are limited for better protection.</p>
      <form id="lock-form">
        <div class="pass-row">
          <input id="lock-pass" type="password" placeholder="Password" autocomplete="current-password" />
          <button type="button" class="button-ghost toggle-pass" id="toggle-pass">Show</button>
        </div>
        <div class="caps" id="lock-caps"></div>
        <div style="height: 10px"></div>
        <button type="submit" style="width: 100%">Unlock</button>
      </form>
      <div class="status" id="lock-status"></div>
    </div>
  </div>

  <script>
    const PASSWORD = "Theone42";
    const KEY_UNLOCKED = "marshall-unlocked";
    const SCRAMJET_ENDPOINT = "https://mercuryworkshop.github.io/scramjet/";
    const queryInput = document.getElementById("query");
    const statusEl = document.getElementById("status");
    const chipsEl = document.getElementById("chips");
    const linksEl = document.getElementById("links");
    const viewer = document.getElementById("viewer");
    const frame = document.getElementById("scramjet-frame");
    const lockLayer = document.getElementById("lock");
    const lockStatus = document.getElementById("lock-status");
    const lockPass = document.getElementById("lock-pass");
    const lockCaps = document.getElementById("lock-caps");
    const togglePass = document.getElementById("toggle-pass");
    const capsWarning = document.getElementById("caps-warning");
    const fallbackStatus = document.getElementById("fallback");
    const toolbarStatus = document.getElementById("toolbar-status");
    const recentEl = document.getElementById("recent");
    const reloadBtn = document.getElementById("reload");
    const openDirectBtn = document.getElementById("open-direct");
    const fullscreenBtn = document.getElementById("fullscreen");
    const clearBtn = document.getElementById("clear");
    let loadTimer;
    let currentUrl = "";
    let recentItems = [];
    let attempts = 0;
    let lockoutUntil = 0;

    const presets = [
      "fun free games",
      "retro emulators",
      "math puzzles",
      "space news",
      "cool wallpapers",
      "coding sandboxes"
    ];

    const quickLinks = [
      { label: "Itch.io games", url: "https://itch.io/games" },
      { label: "Classic Reload", url: "https://www.classicreload.com/" },
      { label: "CoolMath Games", url: "https://www.coolmathgames.com/" },
      { label: "Archive.org", url: "https://archive.org/" },
      { label: "Wikipedia", url: "https://wikipedia.org" },
      { label: "YouTube", url: "https://youtube.com" }
    ];

    function setStatus(msg, type = "") {
      statusEl.textContent = msg;
      statusEl.className = `status ${type}`;
      toolbarStatus.textContent = msg || "Idle";
      toolbarStatus.className = `pill ${type === "error" ? "" : "good"}`;
    }

    function setLockStatus(msg, type = "") {
      lockStatus.textContent = msg;
      lockStatus.className = `status ${type}`;
    }

    function normalizeQuery(input) {
      const value = input.trim();
      if (!value) return "";
      const looksLikeUrl = /\./.test(value) && !/\s/.test(value);
      if (looksLikeUrl) {
        return value.startsWith("http://") || value.startsWith("https://") ? value : `https://${value}`;
      }
      const encoded = encodeURIComponent(value);
      return `https://duckduckgo.com/?q=${encoded}`;
    }

    function buildScramjetUrl(targetUrl) {
      const scramjetUrl = new URL(SCRAMJET_ENDPOINT);
      scramjetUrl.searchParams.set("url", targetUrl);
      scramjetUrl.searchParams.set("embed", "1");
      return scramjetUrl.toString();
    }

    function showFrame() {
      if (!viewer.classList.contains("active")) {
        viewer.classList.add("active");
      }
    }

    function pushRecent(url) {
      if (!url) return;
      recentItems = [url, ...recentItems.filter((item) => item !== url)].slice(0, 6);
      renderRecent();
    }

    function renderRecent() {
      recentEl.innerHTML = "";
      if (!recentItems.length) return;
      recentItems.forEach((url) => {
        const item = document.createElement("div");
        item.className = "recent-item";
        const span = document.createElement("span");
        span.textContent = url;
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "button-ghost";
        btn.textContent = "Re-open";
        btn.addEventListener("click", () => launch(url));
        item.append(span, btn);
        recentEl.appendChild(item);
      });
    }

    function setCapsIndicator(event, target) {
      const active = event.getModifierState && event.getModifierState("CapsLock");
      target.textContent = active ? "Caps Lock is on" : "";
    }

    function launch(url) {
      if (!url) {
        setStatus("Type something first.", "error");
        queryInput.focus();
        return;
      }

      if (loadTimer) {
        clearTimeout(loadTimer);
      }

      const scramjetUrl = buildScramjetUrl(url);
      currentUrl = url;
      showFrame();
      setStatus("Loading with Scramjet...", "");
      frame.src = scramjetUrl;
      fallbackStatus.textContent = "";
      loadTimer = setTimeout(() => {
        setStatus("If it looks stuck, try reloading or open directly in-frame.", "error");
        addFallbackActions(scramjetUrl, url);
      }, 8000);

      frame.onload = () => {
        clearTimeout(loadTimer);
        setStatus("Running inside Scramjet (stays on this page).", "success");
        pushRecent(url);
      };
    }

    function addFallbackActions(scramjetUrl, directUrl) {
      fallbackStatus.textContent = "";
      const wrap = document.createElement("div");
      wrap.className = "stack";

      const scramjetBtn = document.createElement("button");
      scramjetBtn.type = "button";
      scramjetBtn.className = "button-ghost";
      scramjetBtn.textContent = "Retry Scramjet here";
      scramjetBtn.addEventListener("click", () => launch(directUrl));

      const directBtn = document.createElement("button");
      directBtn.type = "button";
      directBtn.className = "button-ghost";
      directBtn.textContent = "Open directly in-frame";
      directBtn.addEventListener("click", () => openDirect(directUrl));

      wrap.append(scramjetBtn, directBtn);
      fallbackStatus.appendChild(wrap);
    }

    function openDirect(url) {
      if (!url) {
        setStatus("No URL to open yet.", "error");
        return;
      }
      showFrame();
      frame.src = url;
      setStatus("Opening without Scramjet (embedded).", "");
    }

    document.querySelector("form.search").addEventListener("submit", (e) => {
      e.preventDefault();
      setStatus("Launching...", "");
      const url = normalizeQuery(queryInput.value);
      launch(url);
    });

    presets.forEach((text) => {
      const chip = document.createElement("button");
      chip.type = "button";
      chip.textContent = text;
      chip.className = "chip";
      chip.addEventListener("click", () => {
        queryInput.value = text;
        queryInput.focus();
      });
      chipsEl.appendChild(chip);
    });

    quickLinks.forEach(({ label, url }) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.textContent = label;
      btn.className = "link-card";
      btn.addEventListener("click", () => launch(url));
      linksEl.appendChild(btn);
    });

    reloadBtn.addEventListener("click", () => {
      if (!currentUrl) {
        setStatus("Nothing to reload yet.", "error");
        return;
      }
      launch(currentUrl);
    });

    openDirectBtn.addEventListener("click", () => openDirect(currentUrl));

    fullscreenBtn.addEventListener("click", () => {
      viewer.classList.toggle("fullscreen");
      fullscreenBtn.textContent = viewer.classList.contains("fullscreen") ? "Exit fullscreen" : "Fullscreen";
    });

    clearBtn.addEventListener("click", () => {
      frame.src = "about:blank";
      setStatus("Viewer cleared.", "");
      currentUrl = "";
    });

    queryInput.addEventListener("keydown", (event) => setCapsIndicator(event, capsWarning));
    lockPass.addEventListener("keydown", (event) => setCapsIndicator(event, lockCaps));

    togglePass.addEventListener("click", () => {
      const isText = lockPass.type === "text";
      lockPass.type = isText ? "password" : "text";
      togglePass.textContent = isText ? "Show" : "Hide";
      lockPass.focus();
    });

    function unlock() {
      lockLayer.classList.add("hide");
      setTimeout(() => lockLayer.remove(), 260);
      queryInput.focus();
      localStorage.setItem(KEY_UNLOCKED, "1");
      setStatus("Unlocked. Ready to launch.", "success");
    }

    function applyLockout(durationMs) {
      lockoutUntil = Date.now() + durationMs;
      lockPass.disabled = true;
      togglePass.disabled = true;
      setLockStatus(`Locked for ${Math.round(durationMs / 1000)} seconds.`, "error");
      const interval = setInterval(() => {
        const remaining = lockoutUntil - Date.now();
        if (remaining <= 0) {
          clearInterval(interval);
          lockPass.disabled = false;
          togglePass.disabled = false;
          setLockStatus("Try again.", "");
          lockPass.focus();
        } else {
          setLockStatus(`Locked for ${Math.ceil(remaining / 1000)} seconds...`, "error");
        }
      }, 500);
    }

    document.getElementById("lock-form").addEventListener("submit", (e) => {
      e.preventDefault();
      if (Date.now() < lockoutUntil) return;
      const val = lockPass.value.trim();
      if (val === PASSWORD) {
        setLockStatus("Unlocked.", "success");
        unlock();
      } else {
        attempts += 1;
        const left = Math.max(0, 5 - attempts);
        setLockStatus(left ? `Wrong password. ${left} tries left.` : "Too many attempts.", "error");
        lockPass.focus();
        if (!left) {
          applyLockout(30000);
          attempts = 0;
        }
      }
    });

    if (localStorage.getItem(KEY_UNLOCKED) === "1") {
      unlock();
    } else {
      lockPass.focus();
    }
  </script>
</body>
</html>
